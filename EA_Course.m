%% Assist to evaluate the teaching objective achievement
%
% 参数说明
% 输入参数：CourseName - char 进行课程目标达成度分析的课程名称
%          Class      - char 进行课程目标达成度分析的课程年级
%          WayDefs    - double array 考查方式定义向量
% 输出参数：QE_Course  - struct 课程目标达成度分析结果
%
%  by Dr. GUAN Guoqiang @ SCUT on 2019-09-14
%

function QE_Course = EA_Course(CourseName, Class, WayDefs)
%% Initialize
opt = 0; % 运行模式为安静模式
idx = 0;
prompt0 = '输入进行课程达成度分析的课程名称后按回车\n课程名称： ';
prompt1 = '输入相应的年级（例如class2013）：';
prompt2 = '输入该课程的教学目标数目：';
if nargin == 0 %  Input the course name
    CourseName = input(prompt0, 's');
    Class = input(prompt1, 's');
    opt = 1; % 运行模式为对话输入模式
end

%% 根据输入课程名称在db_Curriculum中获取该课程支撑的毕业要求指标点
%  Acquire the preset course info 
load('database.mat', 'db_Curriculum', 'db_GradRequire');
K = length(db_Curriculum.Name); % number of courses
for i = 1:K
    name = db_Curriculum.Name{i};
    if size(CourseName) == size(name)
        if CourseName == name
            idx = i;
            break
        end
    end
end
if idx == 0
    fprintf('Input course is NOT found! \n');
    return
else
    fprintf('Input course is found as \n');
    idx_UniNum = find(db_Curriculum.ReqMatrix(idx,:));
    M = sum(db_Curriculum.ReqMatrix(idx,:)); % number of supported indicator
end

%% 调用GetData导入全部课程的成绩单
db_Outcome = GetData({Class});
Transcript = db_Outcome(idx).(Class);
if isempty(Transcript)
    disp('No transcript in dataset and STOP')
    return
end
QE_Course.ID = db_Curriculum.ID{idx};
QE_Course.Name = db_Curriculum.Name{idx};
QE_Course.(Class).Requirements.IdxUniNum = idx_UniNum;
QE_Course.(Class).Requirements.Description = db_GradRequire(idx_UniNum,2);

%% Supply info in syllabus
%  Input the number of teaching objectives
if opt == 1
    prompt2 = sprintf('%s [直接回车输入缺省值 %d ]: ', prompt2, M);
    N = input(prompt2);
    if isempty(N)
       N = M; % Default value
    end
    %  Input the relation matrix of teaching objectives and supported
    %  graduation requirement
    prompt3 = '输入教学目标与毕业要求指标点的关系矩阵[M,N] [直接回车输入缺省值] ';
    C = input(prompt3);
    if isempty(C)
        C = eye(M); %  Default matrix of C(M,N), where M=N
    end
    if M ~= size(C, 1) && N ~= size(C, 2)
        fprintf('Error: size(C,1) = %d not %d, or size(C,2) = %d not %d \n', ...
                size(C, 1), M, size(C, 2), N);
        return
    end
else
    N = M;
    C = eye(M);
end
QE_Course.(Class).RelMatrix.Req2Obj = C;

%  Input the relation matrix of teaching contents and objectives
if opt == 1
    prompt4 = '输入教学目标考查方式的定义向量 [直接回车输入缺省值：通过期末考试的综合成绩评价] ';
    WayDefs = input(prompt4);
    if isempty(WayDefs)
        WayDefs = [1];
    end
end
QE_Course.(Class).Evaluation.WayDefs = WayDefs;


end
